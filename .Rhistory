mutate(well = paste0(well_lett, well_num)) %>%
select(!c(well_lett, well_num, strain_tally)) %>% tail()
library(tidyverse)
library(tidyr)
library(stats)
library(dendextend)
# plots to choose strains
symp <- read.csv("2025_07_22_symptoms_for_theo.csv", header = TRUE, stringsAsFactors = FALSE)
barcodes <- read.csv("bcs_hoi2pick_clean.csv", header = TRUE, stringsAsFactors = FALSE)
psy_geno <- read.csv("2025_07_22_psy_geno_dist_for_theo.tsv", header = FALSE,
stringsAsFactors = FALSE, sep = "\t")
xcc_geno <- read.csv("2025_07_22_xcc_geno_dist_for_theo.tsv", header = FALSE,
stringsAsFactors = FALSE, sep = "\t")
ggplot(symp, aes(x = MeanChange)) +
geom_histogram(binwidth = 0.1, fill = "darkblue", color = "black") +
labs(title = "Distribution of Mean Change in Symptoms",
x = "Mean Change in Symptoms",
y = "Frequency") +
theme_classic()
non_killer_strains <- merge(symp, barcodes) %>%
arrange(strain) %>%
filter(MeanChange > -0.5)# %>%
#  filter(country == "US")
ggplot(non_killer_strains, aes(x = MeanChange)) +
geom_histogram(binwidth = 0.1, fill = "darkblue", color = "black") +
labs(title = "Distribution of Mean Change in Symptoms",
x = "Mean Change in Symptoms",
y = "Frequency") +
theme_classic()
strain_dict <- non_killer_strains %>%
select(strain, Sample)
strain_dict_with_countries <- non_killer_strains %>%
select(strain, Sample, country)
colnames(psy_geno) <- c("Sample", "Sample2", "dist")
relabeled_psy_geno <- merge(psy_geno, strain_dict)
colnames(relabeled_psy_geno) <- c("Sample1", "Sample", "dist", "strain1")
relabeled_psy_geno <- merge(relabeled_psy_geno, strain_dict)
colnames(relabeled_psy_geno) <- c("Sample1", "Sample2", "dist", "strain1", "strain2")
relabeled_psy_geno <- relabeled_psy_geno %>%
select(strain1, strain2, dist) %>%
arrange(strain1, strain2)
psy_dist_mat <- with(relabeled_psy_geno, dist)
nams <- with(relabeled_psy_geno, unique(c(as.character(strain1), as.character(strain2))))
attributes(psy_dist_mat) <- with(relabeled_psy_geno, list(Size = length(nams),
Labels = nams,
Diag = FALSE,
Upper = FALSE,
method = "user"))
class(psy_dist_mat) <- "dist"
hc_psy <- hclust(psy_dist_mat, method = "average")
dend_psy <- as.dendrogram(hc_psy)
cutree(dend_psy, h = 0.05)
cutree(dend_psy, k = 6)
dend_psy <- color_branches(dend_psy, k = 6, colors = c("red", "blue", "green", "purple", "orange", "cyan"))
country_colors <- data.frame(strain = labels(dend_psy))
country_colors <- merge(country_colors, strain_dict_with_countries) # there is a small bug here!
country_colors <- country_colors %>%
mutate(color = case_when(
country == "US" ~ "red",
country == "France" ~ "blue",
country == "Germany" ~ "green"
))
col_labels <- country_colors$color[order.dendrogram(dend_psy)]
labels_colors(dend_psy) <- col_labels
plot(dend_psy, main = "Hierarchical Clustering for Psy",
xlab = "Strains", ylab = "Distance", cex = 0.5, horiz = T)
jpeg("2025_07_22_psy_dendrogram.jpg", width = 1400, height = 1200)
plot(dend_psy, main = "Hierarchical Clustering for Psy",
xlab = "Strains", ylab = "Distance", cex = 0.5, horiz = T)
dev.off()
selected_strains <- c("FR 23E12",
"FR 34D6",
"FR 105",
"MEB058",
"GE 25C2",
"LMC_A8")
alternate_strains <- c("GE 12F6",
"GE 13D10",
"1G3")
# other alternates
# "FR 3C11"
# "NL P184"
# countries for selected strains
strain_countries <- strain_dict_with_countries %>%
filter(strain %in% selected_strains) %>%
select(strain, country)
print(strain_countries)
# countries for alternate strains
strain_countries <- strain_dict_with_countries %>%
filter(strain %in% alternate_strains) %>%
select(strain, country)
print(strain_countries)
symp_with_strains <- merge(symp, barcodes)
# symptoms for selected strains
symptoms_selected <- symp_with_strains %>%
filter(strain %in% selected_strains) %>%
select(strain, MeanChange, country)
print(symptoms_selected)
# symptoms for alternate strains
symptoms_alternate <- symp_with_strains %>%
filter(strain %in% alternate_strains) %>%
select(strain, MeanChange, country)
print(symptoms_alternate)
# printing out chosen plates
barcodes %>%
filter(strain %in% selected_strains) %>%
arrange(plate, strain) %>%
select(plate, position, Sample, strain)
# printing out alternate plates
barcodes %>%
filter(strain %in% alternate_strains) %>%
arrange(plate, strain) %>%
select(plate, position, Sample, strain)
# printing out all chosen plates
psy_plates <- barcodes %>%
filter(strain %in% selected_strains | strain %in% alternate_strains) %>%
arrange(plate, strain) %>%
select(plate, position, Sample, strain) %>%
filter(plate != "Mix4")
print(psy_plates)
write.csv(psy_plates, "chosen_psy_plates.csv", row.names = FALSE)
head(psy_plates)
psy_strain_to_well <- psy_plates %>%
group_by(strain) %>%
mutate(strain_tally = row_number()) %>%
ungroup() %>%
filter(strain_tally<= 4) %>%
mutate(well_lett = rep(c("A", "B", "C"), each = 12)) %>%
mutate(well_num = rep(1:12, times = 3)) %>%
mutate(well = paste0(well_lett, well_num)) %>%
select(!c(well_lett, well_num, strain_tally))
write.csv(psy_strain_to_well, "psy_strain_to_well.csv", row.names = FALSE)
# Uncomment the following lines if you want to plot the dendrograms without subsetting
#full_psy_dist_mat <- with(psy_geno, dist)
#nams <- with(psy_geno, unique(c(as.character(Sample), as.character(Sample2))))
#attributes(full_psy_dist_mat) <- with(psy_geno, list(Size = length(nams),
#                                                          Labels = nams,
#                                                          Diag = FALSE,
#                                                          Upper = FALSE,
#                                                          method = "user"))
#class(full_psy_dist_mat) <- "dist"
#hc_psy <- hclust(full_psy_dist_mat, method = "average")
#plot(hc_psy, main = "Hierarchical Clustering for Psy without Subsetting",
#     xlab = "Strains", ylab = "Distance", cex = 0.5)
colnames(xcc_geno) <- c("Sample", "Sample2", "dist")
relabeled_xcc_geno <- merge(xcc_geno, strain_dict)
colnames(relabeled_xcc_geno) <- c("Sample1", "Sample", "dist", "strain1")
relabeled_xcc_geno <- merge(relabeled_xcc_geno, strain_dict)
colnames(relabeled_xcc_geno) <- c("Sample1", "Sample2", "dist", "strain1", "strain2")
relabeled_xcc_geno <- relabeled_xcc_geno %>%
select(strain1, strain2, dist) %>%
arrange(strain1, strain2)
xcc_dist_mat <- with(relabeled_xcc_geno, dist)
nams <- with(relabeled_xcc_geno, unique(c(as.character(strain1), as.character(strain2))))
attributes(xcc_dist_mat) <- with(relabeled_xcc_geno, list(Size = length(nams),
Labels = nams,
Diag = FALSE,
Upper = FALSE,
method = "user"))
class(xcc_dist_mat) <- "dist"
hc_xcc <- hclust(xcc_dist_mat, method = "average")
dend_xcc <- as.dendrogram(hc_xcc)
cutree(dend_xcc, h = 0.05)
cutree(dend_xcc, k = 6)
xcc_sp <- cutree(dend_xcc, h = 0.05)
xcc_sp[xcc_sp != 1]
dend_xcc <- color_branches(dend_xcc, k = 5, colors = c("red", "blue", "green", "purple", "orange", "cyan"))
country_colors <- data.frame(strain = labels(dend_xcc)) # small bug here
country_colors <- merge(country_colors, strain_dict_with_countries)
country_colors <- country_colors %>%
mutate(color = case_when(
country == "US" ~ "red",
country == "France" ~ "blue",
country == "Germany" ~ "green"
))
col_labels <- country_colors$color[order.dendrogram(dend_xcc)]
labels_colors(dend_xcc) <- col_labels
plot(dend_xcc, main = "Hierarchical Clustering for Xcc",
xlab = "Strains", ylab = "Distance", cex = 0.5, horiz = T)
jpeg("2025_07_22_xcc_dendrogram.jpg", width = 2000, height = 5000, res = 300)
par(mai = c(1, 1, 1, 2))
plot(dend_xcc, main = "Hierarchical Clustering for Xcc",
xlab = "Strains", ylab = "Distance", cex = 0.1, horiz = T)
dev.off()
selected_strains <- c("0225-PANA-C",
"NL_P162",
"LMC_P47",
"ME_P40",
"ME_P66",
"X 6E 14")
alternate_strains <- c("X 6A 34",
"0232-PANA-C",
"NL_P77")
# other alternates
#"X 3D 11"
#"0231-VICT-B",
#"ME_P65",
#"LMC_P11"
# countries for selected strains
strain_countries <- strain_dict_with_countries %>%
filter(strain %in% selected_strains) %>%
select(strain, country)
print(strain_countries)
# countries for alternate strains
strain_countries <- strain_dict_with_countries %>%
filter(strain %in% alternate_strains) %>%
select(strain, country)
print(strain_countries)
symp_with_strains <- merge(symp, barcodes)
# symptoms for selected strains
symptoms_selected <- symp_with_strains %>%
filter(strain %in% selected_strains) %>%
select(strain, MeanChange, country)
print(symptoms_selected)
# symptoms for alternate strains
symptoms_alternate <- symp_with_strains %>%
filter(strain %in% alternate_strains) %>%
select(strain, MeanChange, country)
print(symptoms_alternate)
# printing out chosen plates
barcodes %>%
filter(strain %in% selected_strains) %>%
arrange(plate, strain) %>%
select(plate, position, Sample, strain)
# printing out alternate plates
barcodes %>%
filter(strain %in% alternate_strains) %>%
arrange(plate, strain) %>%
select(plate, position, Sample, strain)
# printing out all chosen plates
xcc_plates <- barcodes %>%
filter(strain %in% selected_strains | strain %in% alternate_strains) %>%
arrange(plate, strain) %>%
select(plate, position, Sample, strain)
print(xcc_plates)
write.csv(xcc_plates, "chosen_xcc_plates.csv", row.names = FALSE)
xcc_strain_to_well <- xcc_plates %>%
group_by(strain) %>%
mutate(strain_tally = row_number()) %>%
ungroup() %>%
filter(strain_tally<= 4) %>%
mutate(well_lett = rep(c("E", "F", "G"), each = 12)) %>%
mutate(well_num = rep(1:12, times = 3)) %>%
mutate(well = paste0(well_lett, well_num)) %>%
select(!c(well_lett, well_num, strain_tally))
write.csv(xcc_strain_to_well, "xcc_strain_to_well", row.names = FALSE)
#full_xcc_dist_mat <- with(xcc_geno, dist)
#nams <- with(xcc_geno, unique(c(as.character(Sample), as.character(Sample2))))
#attributes(full_xcc_dist_mat) <- with(xcc_geno, list(Size = length(nams),
#                                                     Labels = nams,
#                                                     Diag = FALSE,
#                                                     Upper = FALSE,
#                                                     method = "user"))
#class(full_xcc_dist_mat) <- "dist"
#hc_xcc <- hclust(full_xcc_dist_mat, method = "average")
#plot(as.dendrogram(hc_xcc), main = "Hierarchical Clustering for Xcc without Subsetting",
#     xlab = "Strains", ylab = "Distance", cex = 0.5)
library(tidyverse)
library(tidyr)
library(stats)
library(dendextend)
# plots to choose strains
symp <- read.csv("2025_07_22_symptoms_for_theo.csv", header = TRUE, stringsAsFactors = FALSE)
barcodes <- read.csv("bcs_hoi2pick_clean.csv", header = TRUE, stringsAsFactors = FALSE)
psy_geno <- read.csv("2025_07_22_psy_geno_dist_for_theo.tsv", header = FALSE,
stringsAsFactors = FALSE, sep = "\t")
xcc_geno <- read.csv("2025_07_22_xcc_geno_dist_for_theo.tsv", header = FALSE,
stringsAsFactors = FALSE, sep = "\t")
ggplot(symp, aes(x = MeanChange)) +
geom_histogram(binwidth = 0.1, fill = "darkblue", color = "black") +
labs(title = "Distribution of Mean Change in Symptoms",
x = "Mean Change in Symptoms",
y = "Frequency") +
theme_classic()
non_killer_strains <- merge(symp, barcodes) %>%
arrange(strain) %>%
filter(MeanChange > -0.5)# %>%
#  filter(country == "US")
ggplot(non_killer_strains, aes(x = MeanChange)) +
geom_histogram(binwidth = 0.1, fill = "darkblue", color = "black") +
labs(title = "Distribution of Mean Change in Symptoms",
x = "Mean Change in Symptoms",
y = "Frequency") +
theme_classic()
strain_dict <- non_killer_strains %>%
select(strain, Sample)
strain_dict_with_countries <- non_killer_strains %>%
select(strain, Sample, country)
colnames(psy_geno) <- c("Sample", "Sample2", "dist")
relabeled_psy_geno <- merge(psy_geno, strain_dict)
colnames(relabeled_psy_geno) <- c("Sample1", "Sample", "dist", "strain1")
relabeled_psy_geno <- merge(relabeled_psy_geno, strain_dict)
colnames(relabeled_psy_geno) <- c("Sample1", "Sample2", "dist", "strain1", "strain2")
relabeled_psy_geno <- relabeled_psy_geno %>%
select(strain1, strain2, dist) %>%
arrange(strain1, strain2)
psy_dist_mat <- with(relabeled_psy_geno, dist)
nams <- with(relabeled_psy_geno, unique(c(as.character(strain1), as.character(strain2))))
attributes(psy_dist_mat) <- with(relabeled_psy_geno, list(Size = length(nams),
Labels = nams,
Diag = FALSE,
Upper = FALSE,
method = "user"))
class(psy_dist_mat) <- "dist"
hc_psy <- hclust(psy_dist_mat, method = "average")
dend_psy <- as.dendrogram(hc_psy)
cutree(dend_psy, h = 0.05)
cutree(dend_psy, k = 6)
dend_psy <- color_branches(dend_psy, k = 6, colors = c("red", "blue", "green", "purple", "orange", "cyan"))
country_colors <- data.frame(strain = labels(dend_psy))
country_colors <- merge(country_colors, strain_dict_with_countries) # there is a small bug here!
country_colors <- country_colors %>%
mutate(color = case_when(
country == "US" ~ "red",
country == "France" ~ "blue",
country == "Germany" ~ "green"
))
col_labels <- country_colors$color[order.dendrogram(dend_psy)]
labels_colors(dend_psy) <- col_labels
plot(dend_psy, main = "Hierarchical Clustering for Psy",
xlab = "Strains", ylab = "Distance", cex = 0.5, horiz = T)
jpeg("2025_07_22_psy_dendrogram.jpg", width = 1400, height = 1200)
plot(dend_psy, main = "Hierarchical Clustering for Psy",
xlab = "Strains", ylab = "Distance", cex = 0.5, horiz = T)
dev.off()
selected_strains <- c("FR 23E12",
"FR 34D6",
"FR 105",
"MEB058",
"GE 25C2",
"LMC_A8")
alternate_strains <- c("GE 12F6",
"GE 13D10",
"1G3")
# other alternates
# "FR 3C11"
# "NL P184"
# countries for selected strains
strain_countries <- strain_dict_with_countries %>%
filter(strain %in% selected_strains) %>%
select(strain, country)
print(strain_countries)
# countries for alternate strains
strain_countries <- strain_dict_with_countries %>%
filter(strain %in% alternate_strains) %>%
select(strain, country)
print(strain_countries)
symp_with_strains <- merge(symp, barcodes)
# symptoms for selected strains
symptoms_selected <- symp_with_strains %>%
filter(strain %in% selected_strains) %>%
select(strain, MeanChange, country)
print(symptoms_selected)
# symptoms for alternate strains
symptoms_alternate <- symp_with_strains %>%
filter(strain %in% alternate_strains) %>%
select(strain, MeanChange, country)
print(symptoms_alternate)
# printing out chosen plates
barcodes %>%
filter(strain %in% selected_strains) %>%
arrange(plate, strain) %>%
select(plate, position, Sample, strain)
# printing out alternate plates
barcodes %>%
filter(strain %in% alternate_strains) %>%
arrange(plate, strain) %>%
select(plate, position, Sample, strain)
# printing out all chosen plates
psy_plates <- barcodes %>%
filter(strain %in% selected_strains | strain %in% alternate_strains) %>%
arrange(plate, strain) %>%
select(plate, position, Sample, strain) %>%
filter(plate != "Mix4")
print(psy_plates)
write.csv(psy_plates, "chosen_psy_plates.csv", row.names = FALSE)
head(psy_plates)
psy_strain_to_well <- psy_plates %>%
group_by(strain) %>%
mutate(strain_tally = row_number()) %>%
ungroup() %>%
filter(strain_tally<= 4) %>%
mutate(well_lett = rep(c("A", "B", "C"), each = 12)) %>%
mutate(well_num = rep(1:12, times = 3)) %>%
mutate(well = paste0(well_lett, well_num)) %>%
select(!c(well_lett, well_num, strain_tally))
write.csv(psy_strain_to_well, "psy_strain_to_well.csv", row.names = FALSE)
# Uncomment the following lines if you want to plot the dendrograms without subsetting
#full_psy_dist_mat <- with(psy_geno, dist)
#nams <- with(psy_geno, unique(c(as.character(Sample), as.character(Sample2))))
#attributes(full_psy_dist_mat) <- with(psy_geno, list(Size = length(nams),
#                                                          Labels = nams,
#                                                          Diag = FALSE,
#                                                          Upper = FALSE,
#                                                          method = "user"))
#class(full_psy_dist_mat) <- "dist"
#hc_psy <- hclust(full_psy_dist_mat, method = "average")
#plot(hc_psy, main = "Hierarchical Clustering for Psy without Subsetting",
#     xlab = "Strains", ylab = "Distance", cex = 0.5)
colnames(xcc_geno) <- c("Sample", "Sample2", "dist")
relabeled_xcc_geno <- merge(xcc_geno, strain_dict)
colnames(relabeled_xcc_geno) <- c("Sample1", "Sample", "dist", "strain1")
relabeled_xcc_geno <- merge(relabeled_xcc_geno, strain_dict)
colnames(relabeled_xcc_geno) <- c("Sample1", "Sample2", "dist", "strain1", "strain2")
relabeled_xcc_geno <- relabeled_xcc_geno %>%
select(strain1, strain2, dist) %>%
arrange(strain1, strain2)
xcc_dist_mat <- with(relabeled_xcc_geno, dist)
nams <- with(relabeled_xcc_geno, unique(c(as.character(strain1), as.character(strain2))))
attributes(xcc_dist_mat) <- with(relabeled_xcc_geno, list(Size = length(nams),
Labels = nams,
Diag = FALSE,
Upper = FALSE,
method = "user"))
class(xcc_dist_mat) <- "dist"
hc_xcc <- hclust(xcc_dist_mat, method = "average")
dend_xcc <- as.dendrogram(hc_xcc)
cutree(dend_xcc, h = 0.05)
cutree(dend_xcc, k = 6)
xcc_sp <- cutree(dend_xcc, h = 0.05)
xcc_sp[xcc_sp != 1]
dend_xcc <- color_branches(dend_xcc, k = 5, colors = c("red", "blue", "green", "purple", "orange", "cyan"))
country_colors <- data.frame(strain = labels(dend_xcc)) # small bug here
country_colors <- merge(country_colors, strain_dict_with_countries)
country_colors <- country_colors %>%
mutate(color = case_when(
country == "US" ~ "red",
country == "France" ~ "blue",
country == "Germany" ~ "green"
))
col_labels <- country_colors$color[order.dendrogram(dend_xcc)]
labels_colors(dend_xcc) <- col_labels
plot(dend_xcc, main = "Hierarchical Clustering for Xcc",
xlab = "Strains", ylab = "Distance", cex = 0.5, horiz = T)
jpeg("2025_07_22_xcc_dendrogram.jpg", width = 2000, height = 5000, res = 300)
par(mai = c(1, 1, 1, 2))
plot(dend_xcc, main = "Hierarchical Clustering for Xcc",
xlab = "Strains", ylab = "Distance", cex = 0.1, horiz = T)
dev.off()
selected_strains <- c("0225-PANA-C",
"NL_P162",
"LMC_P47",
"ME_P40",
"ME_P66",
"X 6E 14")
alternate_strains <- c("X 6A 34",
"0232-PANA-C",
"NL_P77")
# other alternates
#"X 3D 11"
#"0231-VICT-B",
#"ME_P65",
#"LMC_P11"
# countries for selected strains
strain_countries <- strain_dict_with_countries %>%
filter(strain %in% selected_strains) %>%
select(strain, country)
print(strain_countries)
# countries for alternate strains
strain_countries <- strain_dict_with_countries %>%
filter(strain %in% alternate_strains) %>%
select(strain, country)
print(strain_countries)
symp_with_strains <- merge(symp, barcodes)
# symptoms for selected strains
symptoms_selected <- symp_with_strains %>%
filter(strain %in% selected_strains) %>%
select(strain, MeanChange, country)
print(symptoms_selected)
# symptoms for alternate strains
symptoms_alternate <- symp_with_strains %>%
filter(strain %in% alternate_strains) %>%
select(strain, MeanChange, country)
print(symptoms_alternate)
# printing out chosen plates
barcodes %>%
filter(strain %in% selected_strains) %>%
arrange(plate, strain) %>%
select(plate, position, Sample, strain)
# printing out alternate plates
barcodes %>%
filter(strain %in% alternate_strains) %>%
arrange(plate, strain) %>%
select(plate, position, Sample, strain)
# printing out all chosen plates
xcc_plates <- barcodes %>%
filter(strain %in% selected_strains | strain %in% alternate_strains) %>%
arrange(plate, strain) %>%
select(plate, position, Sample, strain)
print(xcc_plates)
write.csv(xcc_plates, "chosen_xcc_plates.csv", row.names = FALSE)
xcc_strain_to_well <- xcc_plates %>%
group_by(strain) %>%
mutate(strain_tally = row_number()) %>%
ungroup() %>%
filter(strain_tally<= 4) %>%
mutate(well_lett = rep(c("E", "F", "G"), each = 12)) %>%
mutate(well_num = rep(1:12, times = 3)) %>%
mutate(well = paste0(well_lett, well_num)) %>%
select(!c(well_lett, well_num, strain_tally))
write.csv(xcc_strain_to_well, "xcc_strain_to_well.csv", row.names = FALSE)
#full_xcc_dist_mat <- with(xcc_geno, dist)
#nams <- with(xcc_geno, unique(c(as.character(Sample), as.character(Sample2))))
#attributes(full_xcc_dist_mat) <- with(xcc_geno, list(Size = length(nams),
#                                                     Labels = nams,
#                                                     Diag = FALSE,
#                                                     Upper = FALSE,
#                                                     method = "user"))
#class(full_xcc_dist_mat) <- "dist"
#hc_xcc <- hclust(full_xcc_dist_mat, method = "average")
#plot(as.dendrogram(hc_xcc), main = "Hierarchical Clustering for Xcc without Subsetting",
#     xlab = "Strains", ylab = "Distance", cex = 0.5)
